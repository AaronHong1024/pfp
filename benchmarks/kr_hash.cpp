//
// Created by marco on 1/24/22.
//

#include <hayai/hayai.hpp>
#include <utils.hpp>

//------------------------------------------------------------------------------

std::string test_string = "CCACACCACACCCACACACCCACACACCACACCACACACCACACCACACCCACACACACA"
                          "CATCCTAACACTACCCTAACACAGCCCTAATCTAACCCTGGCCAACCTGTCTCTCAACTT"
                          "ACCCTCCATTACCCTGCCTCCACTCGTTACCCTGTCCCATTCAACCATACCACTCCGAAC"
                          "CACCATCCATCCCTCTACTTACTACCACTCACCCACCGTTACCCTCCAATTACCCATATC"
                          "CAACCCACTGCCACTTACCCTACCATTACCCTACCATCCACCATGACCTACTCACCATAC"
                          "TGTTCTTCTACCCACCATATTGAAACGCTAACAAATGATCGTAAATAACACACACGTGCT"
                          "TACCCTACCACTTTATACCACCACCACATGCCATACTCACCCTCACTTGTATACTGATTT"
                          "TACGTACGCACACGGATGCTACAGTATATACCATCTCAAACTTACCCTACTCTCAGATTC"
                          "CACTTCACTCCATGGCCCATCTCTCACTGAATCAGTACCAAATGCACTCACATCATTATG"
                          "CACGGCACTTGCCTCAGCGGTCTATACCCTGTGCCATTTACCCATAACGCCCATCATTAT"
                          "CCACATTTTGATATCTATATCTCATTCGGCGGTCCCAAATATTGTATAACTGCCCTTAAT"
                          "ACATACGTTATACCACTTTTGCACCATATACTTACCACTCCATTTATATACACTTATGTC"
                          "AATATTACAGAAAAATCCCCACAAAAATCACCTAAACATAAAAATATTCTACTTTTCAAC"
                          "AATAATACATAAACATATTGGCTTGTGGTAGCAACACTATCATGGTATCACTAACGTAAA"
                          "AGTTCCTCAATATTGCAATTTGCTTGAACGGATGCTATTTCAGAATATTTCGTACTTACA"
                          "CAGGCCATACATTAGAATAATATGTCACATCACTGTCGTAACACTCTTTATTCACCGAGC"
                          "AATAATACGGTAGTGGCTCAAACTCATGCGGGTGCTATGATACAATTATATCTTATTTCC"
                          "ATTCCCATATGCTAACCGCAATATCCTAAAAGCATAACTGATGCATCTTTAATCTTGTAT"
                          "GTGACACTACTCATACGAAGGGACTATATCTAGTCAAGACGATACTGTGATAGGTACGTT"
                          "ATTTAATAGGATCTATAACGAAATGTCAAATAATTTTACGGTAATATAACTTATCAGCGG"
                          "CGTATACTAAAACGGACGTTACGATATTGTCTCACTTCATCTTACCACCCTCTATCTTAT"
                          "TGCTGATAGAACACTAACCCCTCAGCTTTATTTCTAGTTACAGTTACACAAAAAACTATG"
                          "CCAACCCAGAAATCTTGATATTTTACGTGTCAAAAAATGAGGGTCTCTAAATGAGAGTTT"
                          "GGTACCATGACTTGTAACTCGCACTGCCCTGATCTGCAATCTTGTTCTTAGAAGTGACGC"
                          "ATATTCTATACGGCCCGACGCGACGCGCCAAAAAATGAAAAACGAAGCAGCGACTCATTT"
                          "TTATTTAAGGACAAAGGTTGCGAAGCCGCACATTTCCAATTTCATTGTTGTTTATTGGAC"
                          "ATACACTGTTAGCTTTATTACCGTCCACGTTTTTTCTACAATAGTGTAGAAGTTTCTTTC"
                          "TTATGTTCATCGTATTCATAAAATGCTTCACGAACACCGTCATTGATCAAATAGGTCTAT"
                          "AATATTAATATACATTTATATAATCTACGGTATTTATATCATCAAAAAAAAGTAGTTTTT"
                          "TTATTTTATTTTGTTCGTTAATTTTCAATTTCTATGGAAACCCGTTCGTAAAATTGGCGT"
                          "TTGTCTCTAGTTTGCGATAGTGTAGATACCGTCCTTGGATAGAGCACTGGAGATGGCTGG"
                          "CTTTAATCTGCTGGAGTACCATGGAACACCGGTGATCATTCTGGTCACTTGGTCTGGAGC"
                          "AATACCGGTCAACATGGTGGTGAAGTCACCGTAGTTGAAAACGGCTTCAGCAACTTCGAC"
                          "TGGGTAGGTTTCAGTTGGGTGGGCGGCTTGGAACATGTAGTATTGGGCTAAGTGAGCTCT"
                          "GATATCAGAGACGTAGACACCCAATTCCACCAAGTTGACTCTTTCGTCAGATTGAGCTAG"
                          "AGTGGTGGTTGCAGAAGCAGTAGCAGCGATGGCAGCGACACCAGCGGCGATTGAAGTTAA"
                          "TTTGACCATTGTATTTGTTTTGTTTGTTAGTGCTGATATAAGCTTAACAGGAAAGGAAAG"
                          "AATAAAGACATATTCTCAAAGGCATATAGTTGAAGCAGCTCTATTTATACCCATTCCCTC"
                          "ATGGGTTGTTGCTATTTAAACGATCGCTGACTGGCACCAGTTCCTCATCAAATATTCTCT"
                          "ATATCTCATCTTTCACACAATCTCATTATCTCTATGGAGATGCTCTTGTTTCTGAACGAA"
                          "TCATAAATCTTTCATAGGTTTCGTATGTGGAGTACTGTTTTATGGCGCTTATGTGTATTC"
                          "GTATGCGCAGAATGTGGGAATGCCAATTATAGGGGTGCCGAGGTGCCTTATAAAACCCTT"
                          "TTCTGTGCCTGTGACATTTCCTTTTTCGGTCAAAAAGAATATCCGAATTTTAGATTTGGA"
                          "CCCTCGTACAGAAGCTTATTGTCTAAGCCTGAATTCAGTCTGCTTTAAACGGCTTCCGCG"
                          "GAGGAAATATTTCCATCTCTTGAATTCGTACAACATTAAACGTGTGTTGGGAGTCGTATA"
                          "CTGTTAGGGTCTGTAAACTTGTGAACTCTCGGCAAATGCCTTGGTGCAATTACGTAATTT"
                          "TAGCCGCTGAGAAGCGGATGGTAATGAGACAAGTTGATATCAAACAGATACATATTTAAA"
                          "AGAGGGTACCGCTAATTTAGCAGGGCAGTATTATTGTAGTTTGATATGTACGGCTAACTG"
                          "AACCTAAGTAGGGATATGAGAGTAAGAACGTTCGGCTACTCTTCTTTCTAAGTGGGATTT"
                          "TTCTTAATCCTTGGATTCTTAAAAGGTTATTAAAGTTCCGCACAAAGAACGCTTGGAAAT"
                          "CGCATTCATCAAAGAACAACTCTTCGTTTTCCAAACAATCTTCCCGAAAAAGTAGCCGTT"
                          "CATTTCCCTTCCGATTTCATTCCTAGACTGCCAAATTTTTCTTGCTCATTTATAATGATT"
                          "GATAAGAATTGTATTTGTGTCCCATTCTCGTAGATAAAATTCTTGGATGTTAAAAAATTA"
                          "TTATTTTCTTCATAAAGAAGCTTTCAAGATATAAGATACGAAATAGGGGTTGATAATTGC"
                          "ATGACAGTAGCTTTAGATCAAAAAGGAAAGCATGGAGGGAAACAGTAAACAGTGAAAATT"
                          "CTCTTGAGAACCAAAGTAAACCTTCATTGAAGAGCTTCCTTAAAAAATTTAGAATCTCCC"
                          "ATGTCAACGGGTTTCCATACCTCCCCAGCATCATACATCTTTTTTCAAAGAAACTTCAAA"
                          "TGCCTCTTTTATGCAAGGGGCAAAATCCTGAAATGACTTAAACTTAGCAGTTTCGTCTTT"
                          "TTTCAAAGAGAATGGTTGAAGAAGAATTGTTTTGGACGCTTATTGACAATCTGTTGCATT"
                          "GATAAAGTACCTACTATCCCAGACTATATTTGTATACAAGTACAAAATTAGGTTTGTTGA"
                          "AACAACTTTCCGATCATTGGTGCCCGTATCTGATGTTTTTTTAGTAATTTCTTTGTAAAT"
                          "ACAGGGAGTTGTTTCGAAAGCTTATGAGAAAAATACATGAATGACAGGTAAAAATATTGG"
                          "CTCGAAAAAGAGGACAAAAAGAGAAATCATAAATGAGTAAACCCACTTGCTGGACATTAT"
                          "CCAGTAAAGGCTTGGTAGTAACCATAATATTACCCAGGTACGAAACGCTAAGAACCTTGA"
                          "AAGACTCATAAAACTTCCAGGTTAAGCTATTTTTGAAAATATTCTGAGGTAAAAGCCATT"
                          "AAGGTCCAGATAACCAAGGGACAATAAACCTATGCTTTTCTTGTCTTCAATTTCAGTATC"
                          "TTTCCATTTTGATAATGAGCATGTGATCCGGAAAGCTACTTTATGATGTTTCAAGGCCTG"
                          "AAGTTTGAATATTTATGTAGTTCAACATCAAATGTGTCTATTTTGTGATGAGGCAACCGT"
                          "CGACAACCTTATTATCGAAAAAGAACAACAAGTTCACATGCTTGTTACTCTCTATAACTA"
                          "GAGAGTACTTTTTTTGGAAGCAAGTAAGAATAAGTCAATTTCTACTTACCTCATTAGGGA"
                          "AAAATTTAATAGCAGTTGTTATAACGACAAATACAGGCCCTAAAAAATTCACTGTATTCA"
                          "ATGGTCTACGAATCGTCAATCGCTTGCGGTTATGGCACGAAGAACAATGCAATAGCTCTT"
                          "ACAAGCCACTACATGACAAGCAACTCATAATTTAAGTGGATAGCTTGTGATAAATTGAAT"
                          "TTTCTCTGTTTAGTACTTGCCGAATAGTTACTTGTTAGTTGCAGATGCTTTTTGATGACA"
                          "AAGTTATCAATCTCAATATTAAACTTTTTAGGCTTTCAGGTTTAATCTTTCTTTGAGGGT"
                          "GTATTAATTTTCATACAAATATTTGATTCATTATTCGTTTTACTGTTACATTAGACCTGC"
                          "TCATTACATGGAGTAACTTAAGTTTTCTCAAACGCTTGATAGCATGATTTGATGTAGTAA"
                          "AAAAAAAGGCAGAGTTTCCAAAAAAAATTGTTAATCGACAAAGTTAATATTATGGTGGTA"
                          "GTATCTCAAATATCTGGATAACCAGATCGTACATCTCTGATAAACAATCTTTGCCACTGC"
                          "TTTATCCTTTTAAATTGTATTGAGTGCTTCAGTCATTGCAAAATTTTACGAGATTTAAAA"
                          "TTTGTGAACCCGACCTTACCGAGAAATGATGAGCTAATTTTTATAGGTCGACCCTTCTGT"
                          "CGCTTACTGGGTTGATTATCTTGTGCTTTCTTAGTATCTATCACAAAGGAGACAAAATCG"
                          "TTGATAAAAAGTGCATCAACATTCCCAGCCAGAAAATGCACATCATAAAGACATGTTATT"
                          "CAAGAGCCACGACCGTCTTCAATTTATCTTTTATAAAAAACCCTTGTTCTACTGACAGGA"
                          "TGGAATAGATATTAAATATACATTTTGCATTTTTTTTTTTTTCTGTATTGAAGATTTGTA"
                          "TATGAAAGATGTTTATACATCAAATGCTTTGAATAAAGCCATCTTAATTTCAATTTCATG"
                          "CCCTCCTTCACCGTTTTCTGTTGGTCTAGAGGTAGCTTGTTGTGGTCACTAATGAGAACT"
                          "TAAATAGTTTTCAACTGCTGGTGGTAAATCAATAATTTATGTTCTTAACCTAACATTTGA"
                          "TGACCTTTGATGCGTTGGTTATGTTGAAGACAAATTGCCTCTAATCAGTTCCATTAAGAA"
                          "ATCTTCTTAACTCCTCCAAATATTCTGCCCATACGATACCTATTTGTTTACTTTGTCATT"
                          "TTGCCATAAGATTGGTATCCACTTCTTGTCTGTAAAATAATTAGAAAGTAGCACAATTTT"
                          "TACAGTAATGTAGCACGCGTAACTCCTAAACTTTGTCATAATGGTTGAAATGAATGTATG"
                          "ATATAAAAACTCGGACCCTGTTTTACTTCTTTTATAGAACCTTATTTTTGACGCAGGGAG"
                          "GCGACATTTATCCAAATTAAGTTTTGACATGGCGCATCAGGGAATAAAAAAAACTTTATT"
                          "ATGTGGCCGAATCAACATTAATCAAATGCACTAATATTGTAACGTTCTTACAAAGGGCAG"
                          "ACAACTTGAGAACTTTCATGCGTGCAACAGTATTAATATTTTACTGTCTTGATATCGTTA"
                          "TCCTCATCGTAACGTGAATTTTTTTGTCTCATACGTTAAGGTAAATTTTGATGACCCCCG"
                          "TTGTCCTTGTTTGCCTTACTGTATAAAGCACCCTTTTATTGTTTAGAATACTAGAATGAT"
                          "AACTGCATTCGGACTATGAAAGAAAAAATGGTAGTAGCAAAGGATAGCATCGCCGTATTT"
                          "ACTACTTTGTAAACCAGTGGATTTTTGCTCAACATATAAAAAACTAAAGACCTTTTTTTC"
                          "ATCAATATACTTCTGAGACGTGCAGATGTGATATTCGGGTTTGAGCTTGTAGTCAACGAA"
                          "GCGGGTTCATGGGCAAATTTTCTTTTTTTTCCCTTTTTTTTTGTCTAGATTATTTCGAAT"
                          "ATGAGTTAATCATACGTTGATTAGTACTGTTGGTCTCTCATTGAAATTTTACGTGACACC"
                          "ATCATTTTACTTCCACATAAGTTCTAATGTTACGTAGTTCAATTTTAGTCGACCTAGCTT"
                          "CATATTTATTTTAGAAGCAATTCGTAATTATCATTTTGCTTTCGAAGAAAATTAAGACTT"
                          "CATTTACTATTCTCGTGATATTTTAGTAGGCGCTTCTTTTGTATCGAACCATTTTATTGC"
                          "AATGGCCCTTAAGTTACCGTTATTCATACCAATTTGACGTTAATTTTAAATGCGTTCTGA"
                          "AGTTTCTTAAATAACCCGGATTGGTTAGGTTCACGCCATGCCTGGCGCGTACATTGAGGC"
                          "ATTAGAAGATCCGCAGATAAATAATAAGCTTAGTAAATCCTAAAGATAACAACTAAAATT"
                          "ATATTTCCATCAGCTCAATACCGCAGTACTTTGAAACCTGATTTATATATTGCAGAACTT"
                          "AATTAAAAGTACATTGTAGTTCAAAAAATAAATATCAAACTTTTGGACCCTCTCTTATTG"
                          "CCTCCCAATTAATTAAAACATCTTTTCTTCCAATCTACAGGTTTGAAAAGGTAATAAGTA"
                          "ATATAAACTTGAGAACCAAAAAAAAAAAAAAAAAAATACTGATCCTTACAGGTTTTAAGG"
                          "TTGCAAAGGGAACATTTATTGAAAGGAGCTAACAATAGTGGGTATGAGTAAAGATATATA"
                          "GATCGATATTTTGAATTCTAAATGATGAACTAGGGAAGTAATTTAGGTGAAACATTGCAA"
                          "CCAATCATTTTACACTTTTGGTTGCACGTAATGTACCTTTTTATGATATTTTTTTTTTAT"
                          "AGTAGTAGTGTGAAAATTTCTTCAGGACTTGCAAAAAGAATCTAACTGATCTTCGGATGA"
                          "GCCTTTATCGATTATTTTTTTCCTAAATATAATACTTTACAAGCGAATGTTTTGTTAGGA"
                          "GAAAGATATAAAAATTATGCGGCATAGGCATATTATCCAATAAAAAGGAAATTTATATAT"
                          "AAACTTCATTTACGTCATAAGAAAATGTTAAGTTCTCTTAACGAAAACTGTGCGAATTTT"
                          "GTGTTAAAGCTGGATGATGAGAAATTATTCTCGTATTATTTTTCATCAGATACTGATAAG"
                          "GTTTCAACGTCTTTTGACGTTGGCTTTTCCACACCATGTTTAGAGTTATAAAGCACAATA"
                          "CCGTTCTTCTTGGCATTGTTCCTTTCATCACGTTTATAGAAGTAGAGTACAACAAAAGTC"
                          "CAAATGGAGAGACAAAAAGCAGAACATGCAGTGAAAGTAAACCCCTTTAAATACCTGGGA"
                          "GCTTCTTCTGTTTTCCAAACCAAAACACTTATCCATGCGGTAGATGATTGAGCCATAATA"
                          "TTCATTGTAACTAAAGTAATAGCTCTAGTTTGAGCATCTCGGCGACAAATATCGTTTTGC"
                          "CAAGAGTATAAAACAGGAGCCATAGCCCAACCAAAACATTGCAGCATAAATGCAAACCAT"
                          "TTGGCTCCTTCTGCGACGTCCCAAGCGGCTAATATGGAGTTACCAATGATATTGAAAACC"
                          "TGAGTAAAAATAATCGCAAACCAACGAGAGTGTAATTTATCTGCAATAATACCAGTAAGC"
                          "ATCAAATAAACCATACCTAAACCCGGAGTAATCATGGATAACTGATTGAGCTTAGGAATA"
                          "GAGTATCTTTTCAAAGATTTCAACCATAGTAGGTATGCCCCAGATGAAACATTACTGTCA"
                          "TTCCAACAGAAAATATTCCATAAAGTTAAAATGTATATTTTCCAATCACTGAAAATTGTT"
                          "TTCCACAGTTTAATATCGAATACTTTTGTTTCAAAATCACTTTTACCTGTTTGGTTTTCT"
                          "TTTAATCTTTTCCTCGCCAACCTAATTTCATCATCAGTTAAGAAAATAGAATAACAGTTG"
                          "TATGGGTCACCTGGCAGGGAGTAAAATCCAATAAGGCCCACTACGACAGACACAATAGCG"
                          "TCAATAATAAAGTTCCATCTCCATCCCTCTAAACCATTTACACCATTTAACGATGAATAT"
                          "ACGGCTGACTGGATCCCACCAGCGGATAGAATACCGATATACTGGCCCAAATAGTAAAAA"
                          "GCAGAACGACGCACCATTTCATCATGTTTGTAAAAGGAACCAAACAAATATTGGTATGCC"
                          "AAATAACTTGGCGCTTCAAAAGCCCCAATGAAAAACCTAATTGCTTTCAAGTGTGGTACA"
                          "GAATTGACATATGCAGCACCAACGGTTAAAAGCGACCAACATAAGTCGAGGCTTGGTAAA"
                          "ACATAGTTTAATGGGAGCTTGTTCAGGTAAATCAAAAATGGCAATTGAAATATAATATTA"; // multiplo di 4



//------------------------------------------------------------------------------

void
Mersenne_KR(std::string& s)
{
    vcfbwt::Mersenne_KarpRabinHash kr_window(8, false);

    std::string_view init_window(s.c_str(), 8);
    kr_window.initialize(init_window);
    vcfbwt::hash_type h = kr_window.get_hash();

    for (vcfbwt::size_type i = 8; i < s.size(); i++)
    {
        kr_window.update((vcfbwt::char_type) s[i - 8], (vcfbwt::char_type) s[i]);
        h = kr_window.get_hash();
    }
}

void
KR(std::string& s)
{
    vcfbwt::KarpRabinHash kr_window(8, false);

    std::string_view init_window(s.c_str(), 8);
    kr_window.initialize(init_window);
    vcfbwt::hash_type h = kr_window.get_hash();

    for (vcfbwt::size_type i = 8; i < s.size(); i++)
    {
        kr_window.update((vcfbwt::char_type) s[i - 8], (vcfbwt::char_type) s[i]);
        h = kr_window.get_hash();
    }
}

void
KR_string_hash(std::string& s)
{
    vcfbwt::hash_type hash = vcfbwt::KarpRabinHash::string_hash(s);
}

void
Mersenne_KR_string_hash(std::string& s)
{
    vcfbwt::hash_type hash = vcfbwt::Mersenne_KarpRabinHash::string_hash(s);
}

//------------------------------------------------------------------------------

//BENCHMARK(KR, Manzini, 100, 1000)
//{
//    KR(test_string);
//}
//
//BENCHMARK(KR, Mersenne, 100, 1000)
//{
//    Mersenne_KR(test_string);
//}

BENCHMARK(KRStringHash, Manzini, 10, 100)
{
    KR_string_hash(test_string);
}

BENCHMARK(KRStringHash, Mersenne4, 10, 100)
{
    Mersenne_KR_string_hash(test_string);
}

//------------------------------------------------------------------------------

int main()
{
    hayai::ConsoleOutputter consoleOutputter;

    hayai::Benchmarker::AddOutputter(consoleOutputter);
    hayai::Benchmarker::RunAllTests();
    return 0;

}